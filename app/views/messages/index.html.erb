<h1>チャットルーム</h1>

<% if session[:user_name].present? %>
  <p>ようこそ、<strong><%= session[:user_name] %></strong> さん</p>
  
  <%= turbo_stream_from "messages" %>

  <div id="messages" style="padding-bottom: 120px;">
    <%= render @messages %>
  </div>

  <div style="
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: white;
    padding: 20px;
    border-top: 1px solid #eee;
    box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
  ">
    <div style="max-width: 800px; margin: 0 auto;">
      <%= render "form", message: @message %>
    </div>
  </div>
<% else %>
  <div style="margin-top: 20px; padding: 20px; border: 1px solid #ccc; border-radius: 8px;">
    <h3>名前を入力してください</h3>
    <%= form_with url: set_name_path, local: true do |f| %>
      <div style="margin-bottom: 10px;">
        <%= f.text_field :user_name, 
            placeholder: "あなたの名前", 
            required: true, 
            style: "padding: 8px; width: 200px; border: 1px solid #ccc; border-radius: 4px;" %>
      </div>
      <%= f.submit "チャットを始める", 
          style: "padding: 8px 16px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;" %>
    <% end %>
  </div>
<% end %>
